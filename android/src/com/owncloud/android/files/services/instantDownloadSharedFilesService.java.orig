package com.owncloud.android.files.services;

import android.app.IntentService;
import android.content.Intent;

import com.owncloud.android.authentication.AccountUtils;
import com.owncloud.android.operations.RemoteOperationResult;
<<<<<<< HEAD
import com.owncloud.android.operations.SynchronizeFolderOperation;
import com.owncloud.android.syncadapter.AbstractOwnCloudSyncAdapter;
import com.owncloud.android.syncadapter.FileSyncAdapter;
import com.owncloud.android.ui.activity.FileDisplayActivity;
import com.owncloud.android.ui.activity.InitialPageActivity;
=======
>>>>>>> Instant download of new files

public class instantDownloadSharedFilesService extends IntentService {

    public static String TAG = "instantDownloadSharedFilesService";
    public static final String RESULT = "result";
    public static final String NOTIFICATION = "com.owncloud.android.service.instantDownloadSharedFilesService";
    RemoteOperationResult result;

    public instantDownloadSharedFilesService() {
        super("instantDownloadService");
    }

    @Override
    protected void onHandleIntent(Intent intent) {
<<<<<<< HEAD
        
        /*int parentId = DataStorageManager.ROOT_PARENT_ID;
        String remotePath = OCFile.PATH_SEPARATOR+"Shared/";
        //AbstractOwnCloudSyncAdapter adp = new A;
        Account account = AccountUtils.getCurrentOwnCloudAccount(getApplicationContext());
        WebdavClient client;
        Log.d(TAG,parentId+" ");
        Log.d(TAG,remotePath);
        try {
            Log.d(TAG,"started instant dw service");
            client = OwnCloudClientUtils.createOwnCloudClient(account, getApplicationContext());
            DataStorageManager storagemanager = new FileDataStorageManager(AccountUtils.getCurrentOwnCloudAccount(getApplicationContext()),getContentResolver());
            SynchronizeFolderOperation synchFolderOp = new SynchronizeFolderOperation(  remotePath, 
                    System.currentTimeMillis(), 
                    parentId, 
                    storagemanager,
                    AccountUtils.getCurrentOwnCloudAccount(getApplicationContext()),
                    getApplicationContext()
                  );
            
    result = synchFolderOp.execute(client);
    publishResults(result.getHttpCode());
    //Log.d(TAG,result.getHttpCode()+" ");
    if(result.isSuccess()) {
        
    }*/
        Account account = AccountUtils.getCurrentOwnCloudAccount(getApplicationContext());
        DataStorageManager datastoragemanager = new FileDataStorageManager(account, getContentResolver());
        if(account!=null) {
        FileDisplayActivity f1 = new FileDisplayActivity();
        f1.instantDownloadFile(datastoragemanager);
        }
        /*} catch (OperationCanceledException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        } catch (AuthenticatorException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        } catch (AccountNotFoundException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }*/
        //publishResults(result.getHttpCode());
=======
        Intent instantDownloadIntent = new Intent("instantdownloadreceiver");
        instantDownloadIntent.putExtra("message", "data");
        if(AccountUtils.getCurrentOwnCloudAccount(getApplicationContext()) != null) {
        sendBroadcast(instantDownloadIntent);
        }
>>>>>>> Instant download of new files
    }
}
